"use strict";function addClass(dom,errClass){var hasClass=!!dom.className.match(errClass);if(!hasClass){dom.className+=" "+errClass}}function removeClass(dom,errClass){var hasClass=!!dom.className.match(errClass);if(hasClass){dom.className=dom.className.replace(errClass,"")}}function appendChild(dom,errMsg,formName){var hasClass=!!dom.className.match("axva-"+formName);if(!hasClass){dom.className+="axva-"+formName;var p=document.createElement("p");p.innerHTML=errMsg;p.setAttribute("class","axva-err");dom.parentNode.insertBefore(p,dom.nextSibling)}}function removeChild(dom,errMsg,formName){var hasClass=!!dom.className.match("axva-"+formName);if(hasClass){var p=document.getElementsByClassName("axva-"+formName+"-err")[0];dom.className=dom.className.replace("axva-"+formName,"");dom.parentNode.removeChild(p)}}var regList={ImgCode:/^[0-9a-zA-Z]{4}$/,SmsCode:/^\d{4}$/,MailCode:/^\d{4}$/,UserName:/^[\w|\d]{4,16}$/,Password:/^[\w!@#$%^&*.]{6,16}$/,Mobile:/^1[3|4|5|7|8]\d{9}$/,RealName:/^[\u4e00-\u9fa5|·]{2,16}$|^[a-zA-Z|\s]{2,20}$/,BankNum:/^\d{10,19}$/,Money:/^([1-9]\d*|[0-9]\d*\.\d{1,2}|0)$/,Answer:/^\S+$/,Mail:/^[-a-z0-9~!$%^&*_=+}{'?]+(\.[-a-z0-9~!$%^&*_=+}{'?]+)*@([a-z0-9_][-a-z0-9_]*(\.[-a-z0-9_]+)*\.(aero|arpa|biz|com|coop|edu|gov|info|int|mil|museum|name|net|org|pro|travel|mobi|[a-z][a-z])|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(:[0-9]{1,5})?$/i,Number:/^\d+$/};function noEmpty(value){return value.toString().trim()?true:false}function max(value,rule){return value.length<=rule?true:false}function min(value,rule){return value.length>=rule?true:false}function NumMax(value,rule){return Number(value)<=Number(rule)?true:false}function NumMin(value,rule){return Number(value)>=Number(rule)?true:false}function type(value,rule){return regList[rule].test(value)?true:false}function equal(value,rule,ruleType,formData){return value===formData[rule]?true:false}function unequal(value,rule,ruleType,formData){return value!==formData[rule]?true:false}function pattern(value,rule,ruleType,formData){return rule.test(value)?true:false}function other(value,rule,ruleType,formData){return rule(value)?true:false}function accepted(value,rule,ruleType,formData){return value?true:false}function include(value,rule,ruleType,formData){var list=rule[0];var type=rule[1];if(formData[type]){return list[formData[type]].includes(value)?true:false}}function assert(condition,message){if(!condition){console.error("[axva-warn]:"+message)}}function Rule(opt){var chk_=chk(opt);this.check=chk_[0];this.errMsg=chk_[1];this.pass=chk_[2];this.ruleType=opt.ruleType;this.ruleValue=opt.ruleValue;this.ruleName=opt.formName;if(opt.propCheck==1){if(opt.errClass){this.errMsg?addClass(opt.dom_,opt.errClass):removeClass(opt.dom_,opt.errClass)}else{this.errMsg?appendChild(opt.dom_,chk_[1],opt.formName):removeChild(opt.dom_,chk_[1],opt.formName)}}else if(opt.alone){if(aloneBox&&aloneBox.indexOf(formName)!==-1){this.errMsg?addClass(dom_,errClass):removeClass(dom_,errClass)}}}function chk(opt){var vaResult={};var firstErr=null;var pass=true;opt.check.forEach(function(item){var isPass=checkRule(item,opt.ruleType,opt.ruleValue,opt.formData);vaResult[item]=isPass;if(firstErr===null&&isPass===false){firstErr=getErrMsg({item:item,errMsg:opt.errMsg,ruleValue:opt.ruleValue,ruleType:opt.ruleType,local:opt.local});pass=false}});return[vaResult,firstErr,pass]}function checkRule(item,ruleType,ruleValue,formData){var ruleCheckers={type:type,noEmpty:noEmpty,min:min,max:max,NumMax:NumMax,NumMin:NumMin,equal:equal,unequal:unequal,pattern:pattern,accepted:accepted,other:other,include:include};if(item!=="message"){var checker=ruleCheckers[item];var isPass=!checker||checker(ruleValue,ruleType[item],ruleType,formData,item)}return isPass}function getErrMsg(opt){if(opt.local==="cn"){var errMsgs={type:opt.errMsg+"格式不正确",noEmpty:opt.errMsg+"不能为空",max:opt.errMsg+"不能大于"+opt.ruleType[opt.item],min:opt.errMsg+"不能小于"+opt.ruleType[opt.item],NumMax:opt.errMsg+"不能大于"+opt.ruleType[opt.item],NumMin:opt.errMsg+"不能小于"+opt.ruleType[opt.item],equal:"两次输入的"+opt.errMsg+"不相同",unequal:"两次输入的"+opt.errMsg+"不能相同",pattern:""+opt.errMsg+opt.ruleType.message,accepted:""+opt.errMsg+opt.ruleType.message,other:""+opt.errMsg+opt.ruleType.message,include:""+opt.errMsg+opt.ruleType.message}}else if(opt.local==="pt"){var errMsgs={type:"Formato incorreto <b>"+opt.errMsg+"</b>",noEmpty:"<b>"+opt.errMsg+"</b> Não pode ser vazio",max:"<b>"+opt.errMsg+"</b> Máximo de "+opt.ruleType[opt.item],min:"<b>"+opt.errMsg+"</b> Mínimo de "+opt.ruleType[opt.item],NumMax:"<b>"+opt.errMsg+"</b> Máximo de "+opt.ruleType[opt.item],NumMin:"<b>"+opt.errMsg+"</b> Mínimo de "+opt.ruleType[opt.item],equal:"inserir <b>"+opt.errMsg+"</b> por duas vezes não é equal",unequal:"inserir <b>"+opt.errMsg+"</b> por duas vezes não pode ser equal",pattern:"<b>"+opt.errMsg+"</b> "+opt.ruleType.message,accepted:"<b>"+opt.errMsg+"</b> "+opt.ruleType.message,other:"<b>"+opt.errMsg+"</b> "+opt.ruleType.message,include:"<b>"+opt.errMsg+"</b> "+opt.ruleType.message}}return errMsgs[opt.item]}function getValItem(rule){var item_=[];for(var j in rule){item_.push(j)}return item_}function findEleByName(elements,filter){var result=void 0;for(var i=0;i<elements.length;i++){var prop=elements[i];if(filter===prop.name){result=i;break}}return result}function split(value,rule,item){var splitChar=rule.splitChar||"";var _v=value.split(splitChar);var res=[];for(var i in rule.splits){var s=rule.splits[i];var _va="";if(_v&&_v.length>0&&_v[s.index-1]){_va=_v[s.index-1]}res.push({value:_va,name:item+"."+i,rules:s})}return res}function va(ops){var vm=ops.vnode.context;var ruleValidate=vm.ruleValidate;var item_form=ops.binding.expression;var formData=vm[item_form];var formName=[];var formMsg=[];var formDOM=ops.el;var el_dom=[];var optionalRule=[];var propCheck=0;assert(formDOM,'未设置需要验证哪个表单 <form v-va="xxx"></form>');assert(formData,"未设置表单信息 ruleValidate:{}");if(formDOM.attributes["errClass"]){errClass=formDOM.attributes["errClass"].value}if(formDOM.attributes["propCheck"]){propCheck=formDOM.attributes["propCheck"].value}for(var i=0;i<formDOM.elements.length;i++){var prop=formDOM.elements[i];if(prop.attributes["prop"]){var item=prop.attributes["prop"].value.split(",");formName.push(item[0]);formMsg.push(item[1]);el_dom.push(prop)}}for(var _i=0;_i<formName.length;_i++){var itemname=formName[_i];var rule=ruleValidate[itemname];if(rule){var value_="";if(rule&&formData[itemname]!=null){value_=formData[itemname]}var item_=getValItem(rule);if(propCheck==0&&ops.alone_&&aloneBox.indexOf(ops.alone_)===-1){aloneBox.push(ops.alone_)}optionalRule[itemname]=new Rule({ruleType:rule,ruleValue:value_,errMsg:formMsg[_i],check:item_,formData:formData,formName:itemname,dom_:el_dom[_i],local:ops.local,propCheck:propCheck,errClass:errClass,alone_:ops.alone_});if(rule.split){var extalItems=split(value_,rule.split,itemname);extalItems.forEach(function(ele,index){var _sitem=getValItem(ele.rules);var extralItemIndex=findEleByName(el_dom,ele.name);optionalRule[ele.name]=new Rule({ruleType:ele.rules,ruleValue:ele.value,errMsg:formMsg[extralItemIndex],check:_sitem,formData:formData,formName:ele.name,dom_:el_dom[extralItemIndex],local:ops.local,propCheck:propCheck,errClass:errClass})})}}}vm[item_form+"_valid"]=optionalRule;var firstErr=null;for(var _i2 in optionalRule){if(firstErr===null&&optionalRule[_i2].pass===false){validate.validate=false;validate.errMsg=optionalRule[_i2].errMsg;firstErr=optionalRule[_i2].errMsg;break}else{validate.validate=true;validate.errMsg=""}}}var MyPlugin={};var errClass="";var validate={validate:"",errMsg:null};var saveBox={};var aloneBox=[];MyPlugin.install=function(Vue){var local=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"cn";Vue.directive("va",{bind:function bind(el,binding,vnode,oldVnode){saveBox={el:el,binding:binding,vnode:vnode,oldVnode:oldVnode,local:local};va({el:el,binding:binding,vnode:vnode,oldVnode:oldVnode,local:local})},componentUpdated:function componentUpdated(el,binding,vnode,oldVnode){va({el:el,binding:binding,vnode:vnode,oldVnode:oldVnode,local:local})},update:function update(el,binding,vnode,oldVnode){saveBox={el:el,binding:binding,vnode:vnode,oldVnode:oldVnode,local:local};va({el:el,binding:binding,vnode:vnode,oldVnode:oldVnode,local:local})}}),Vue.prototype.$axva=function(ruleValidate){if(saveBox.local==="cn"){va(saveBox)}return validate};Vue.prototype.$axva_blur=function(alone){va({alone:alone})}};module.exports=MyPlugin;