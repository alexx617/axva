"use strict";function addClass(dom,errClass){var hasClass=!!dom.className.match(errClass);if(!hasClass){dom.className+=" "+errClass}}function removeClass(dom,errClass){var hasClass=!!dom.className.match(errClass);if(hasClass){dom.className=dom.className.replace(errClass,"")}}function appendChild(dom,errMsg,formName){var hasClass=!!dom.className.match("axva-"+formName);if(!hasClass){dom.className+="axva-"+formName;var p=document.createElement("p");p.innerHTML=errMsg;p.setAttribute("class","axva-err");dom.parentNode.insertBefore(p,dom.nextSibling)}}function removeChild(dom,errMsg,formName){var hasClass=!!dom.className.match("axva-"+formName);if(hasClass){var p=document.getElementsByClassName("axva-"+formName+"-err")[0];dom.className=dom.className.replace("axva-"+formName,"");dom.parentNode.removeChild(p)}}var regList={ImgCode:/^[0-9a-zA-Z]{4}$/,SmsCode:/^\d{4}$/,MailCode:/^\d{4}$/,UserName:/^[\w|\d]{4,16}$/,Password:/^[\w!@#$%^&*.]{6,16}$/,Mobile:/^1[3|4|5|7|8]\d{9}$/,RealName:/^[\u4e00-\u9fa5|·]{2,16}$|^[a-zA-Z|\s]{2,20}$/,BankNum:/^\d{10,19}$/,Money:/^([1-9]\d*|[0-9]\d*\.\d{1,2}|0)$/,Answer:/^\S+$/,Mail:/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,Number:/^\d+$/};function noEmpty(value){return value.toString().trim()?true:false}function max(value,rule){return value.length<=rule?true:false}function min(value,rule){return value.length>=rule?true:false}function NumMax(value,rule){return Number(value)<=Number(rule)?true:false}function NumMin(value,rule){return Number(value)>=Number(rule)?true:false}function type(value,rule){return regList[rule].test(value)?true:false}function equal(value,rule,ruleType,formData){return value===formData[rule]?true:false}function unequal(value,rule,ruleType,formData){return value!==formData[rule]?true:false}function pattern(value,rule,ruleType,formData){return rule.test(value)?true:false}function other(value,rule,ruleType,formData){return rule(value)?true:false}function accepted(value,rule,ruleType,formData){return value?true:false}function include(value,rule,ruleType,formData){var list=rule[0];var type=rule[1];if(formData[type]){return list[formData[type]].includes(value)?true:false}}function assert(condition,message){if(!condition){console.error("[axva-warn]:"+message)}}function Rule(ruleType,ruleValue,errMsg,check,formData,formName,dom_){var chk_=chk(check,ruleType,ruleValue,errMsg,formData,formName);this.check=chk_[0];this.errMsg=chk_[1];this.pass=chk_[2];this.ruleType=ruleType;this.ruleValue=ruleValue;this.ruleName=formName;if(propCheck==="true"){if(errClass){this.errMsg?addClass(dom_,errClass):removeClass(dom_,errClass)}else{this.errMsg?appendChild(dom_,chk_[1],formName):removeChild(dom_,chk_[1],formName)}}else if(alone){if(alone&&alone.indexOf(formName)!==-1){this.errMsg?addClass(dom_,errClass):removeClass(dom_,errClass)}}}function chk(check,ruleType,ruleValue,errMsg,formData,formName){var vaResult={};var firstErr=null;var pass=true;check.forEach(function(item){var isPass=checkRule(item,ruleType,ruleValue,formData);vaResult[item]=isPass;if(firstErr===null&&isPass===false){firstErr=getErrMsg(item,errMsg,ruleValue,ruleType);pass=false}});return[vaResult,firstErr,pass]}function checkRule(item,ruleType,ruleValue,formData){var ruleCheckers={type:type,noEmpty:noEmpty,min:min,max:max,NumMax:NumMax,NumMin:NumMin,equal:equal,unequal:unequal,pattern:pattern,accepted:accepted,other:other,include:include};if(item!=="message"){var checker=ruleCheckers[item];var isPass=!checker||checker(ruleValue,ruleType[item],ruleType,formData,item)}return isPass}function getErrMsg(item,errMsg,ruleValue,ruleType){if(local==="cn"){var errMsgs={type:"".concat(errMsg,"格式不正确"),noEmpty:"".concat(errMsg,"不能为空"),max:"".concat(errMsg,"不能大于").concat(ruleType[item]),min:"".concat(errMsg,"不能小于").concat(ruleType[item]),NumMax:"".concat(errMsg,"不能大于").concat(ruleType[item]),NumMin:"".concat(errMsg,"不能小于").concat(ruleType[item]),equal:"两次输入的".concat(errMsg,"不相同"),unequal:"两次输入的".concat(errMsg,"不能相同"),pattern:"".concat(errMsg).concat(ruleType.message),accepted:"".concat(errMsg).concat(ruleType.message),other:"".concat(errMsg).concat(ruleType.message),include:"".concat(errMsg).concat(ruleType.message)}}else if(local==="pt"){var errMsgs={type:"Formato incorreto <b>".concat(errMsg,"</b>"),noEmpty:"<b>".concat(errMsg,"</b> Não pode ser vazio"),max:"<b>".concat(errMsg,"</b> Máximo de ").concat(ruleType[item]),min:"<b>".concat(errMsg,"</b> Mínimo de ").concat(ruleType[item]),NumMax:"<b>".concat(errMsg,"</b> Máximo de ").concat(ruleType[item]),NumMin:"<b>".concat(errMsg,"</b> Mínimo de ").concat(ruleType[item]),equal:"inserir <b>".concat(errMsg,"</b> por duas vezes não é equal"),unequal:"inserir <b>".concat(errMsg,"</b> por duas vezes não pode ser equal"),pattern:"<b>".concat(errMsg,"</b> ").concat(ruleType.message),accepted:"<b>".concat(errMsg,"</b> ").concat(ruleType.message),other:"<b>".concat(errMsg,"</b> ").concat(ruleType.message),include:"<b>".concat(errMsg,"</b> ").concat(ruleType.message)}}return errMsgs[item]}function getValItem(rule){var item_=[];for(var j in rule){item_.push(j)}return item_}function findEleByName(elements,filter){var result=void 0;for(var i=0;i<elements.length;i++){var prop=elements[i];if(filter===prop.name){result=i;break}}return result}function split(value,rule,item){var splitChar=rule.splitChar||"";var _v=value.split(splitChar);var res=[];for(var i in rule.splits){var s=rule.splits[i];var _va="";if(_v&&_v.length>0&&_v[s.index-1]){_va=_v[s.index-1]}res.push({value:_va,name:item+"."+i,rules:s})}return res}function va(alone_){var vm=vnode_.context;var ruleValidate=vm.ruleValidate;var item_form=binding_.expression;var formData=vm[item_form];var formName=[];var formMsg=[];var formDOM=el_;var el_dom=[];var optionalRule=[];assert(formDOM,'未设置需要验证哪个表单 <form v-va="xxx"></form>');assert(formData,"未设置表单信息 ruleValidate:{}");if(formDOM.attributes["errClass"]){errClass=formDOM.attributes["errClass"].value}if(formDOM.attributes["propCheck"]){propCheck=formDOM.attributes["propCheck"].value}for(var i=0;i<formDOM.elements.length;i++){var prop=formDOM.elements[i];if(prop.attributes["prop"]){var item=prop.attributes["prop"].value.split(",");formName.push(item[0]);formMsg.push(item[1]);el_dom.push(prop)}}for(var _i=0;_i<formName.length;_i++){var itemname=formName[_i];var rule=ruleValidate[itemname];if(rule){var value_="";if(rule&&formData[itemname]!=null){value_=formData[itemname]}var item_=getValItem(rule);if(propCheck==="false"&&alone_&&alone.indexOf(alone_)===-1){alone.push(alone_)}optionalRule[itemname]=new Rule(rule,value_,formMsg[_i],item_,formData,itemname,el_dom[_i]);if(rule.split){var extalItems=split(value_,rule.split,itemname);extalItems.forEach(function(ele,index){var _sitem=getValItem(ele.rules);var extralItemIndex=findEleByName(el_dom,ele.name);optionalRule[ele.name]=new Rule(ele.rules,ele.value,formMsg[extralItemIndex],_sitem,formData,ele.name,el_dom[extralItemIndex])})}}}vm[item_form+"_valid"]=optionalRule;var firstErr=null;for(var _i2 in optionalRule){if(firstErr===null&&optionalRule[_i2].pass===false){validate.validate=false;validate.errMsg=optionalRule[_i2].errMsg;firstErr=optionalRule[_i2].errMsg;break}else{validate.validate=true;validate.errMsg=""}}}var MyPlugin={};var errClass="";var validate={validate:"",errMsg:null};var el_;var binding_;var vnode_;var oldVnode_;var local;var propCheck="true";var alone=[];MyPlugin.install=function(Vue){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"cn";local=options;Vue.directive("va",{bind:function bind(el,binding,vnode,oldVnode){el_=el;binding_=binding;vnode_=vnode;oldVnode_=oldVnode;va()},componentUpdated:function componentUpdated(el,binding,vnode,oldVnode){el_=el;binding_=binding;vnode_=vnode;oldVnode_=oldVnode;va()}}),Vue.prototype.$axva=function(){return validate};Vue.prototype.$axva_blur=function(name){va(name)}};module.exports=MyPlugin;