"use strict";var log=console.log;function addClass(dom,errClass){var hasClass=!!dom.className.match(errClass);if(!hasClass){dom.className+=errClass}}function removeClass(dom,errClass){var hasClass=!!dom.className.match(errClass);if(hasClass){dom.className=dom.className.replace(errClass,"")}}function appendChild(dom,errMsg,formName){var hasClass=!!dom.className.match("axva-"+formName);if(!hasClass){dom.className+="axva-"+formName;var p=document.createElement("p");p.innerHTML=errMsg;p.setAttribute("class","axva-"+formName+"-err");dom.parentNode.insertBefore(p,dom.nextSibling)}}function removeChild(dom,errMsg,formName){var hasClass=!!dom.className.match("axva-"+formName);if(hasClass){var p=document.getElementsByClassName("axva-"+formName+"-err")[0];dom.className=dom.className.replace("axva-"+formName,"");dom.parentNode.removeChild(p)}}var regList={ImgCode:/^[0-9a-zA-Z]{4}$/,SmsCode:/^\d{4}$/,MailCode:/^\d{4}$/,UserName:/^[\w|\d]{4,16}$/,Password:/^[\w!@#$%^&*.]{6,16}$/,Mobile:/^1[3|4|5|7|8]\d{9}$/,RealName:/^[\u4e00-\u9fa5|·]{2,16}$|^[a-zA-Z|\s]{2,20}$/,BankNum:/^\d{10,19}$/,Money:/^([1-9]\d*|[0-9]\d*\.\d{1,2}|0)$/,Answer:/^\S+$/,Mail:/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,Number:/^\d+$/};function noEmpty(value){return value.toString().trim()?true:false}function max(value,rule){return value<=rule?true:false}function min(value,rule){return value>=rule?true:false}function type(value,rule){return regList[rule].test(value)?true:false}function equal(value,rule,ruleType,formData){return value===formData[rule]?true:false}function unequal(value,rule,ruleType,formData){return value!==formData[rule]?true:false}function pattern(value,rule,ruleType,formData){return rule.test(value)?true:false}function accepted(value,rule,ruleType,formData){return value?true:false}function assert(condition,message){if(!condition){console.error("[va-warn]:"+message)}}function Rule(ruleType,ruleValue,errMsg,check,formData,formName,dom_){var chk_=chk(check,ruleType,ruleValue,errMsg,formData,formName);this.check=chk_[0];this.errMsg=chk_[1];this.pass=chk_[2];this.ruleType=ruleType;this.ruleValue=ruleValue;this.ruleName=formName;if(errClass){this.errMsg?addClass(dom_,errClass):removeClass(dom_,errClass)}else{this.errMsg?appendChild(dom_,chk_[1],formName):removeChild(dom_,chk_[1],formName)}}function chk(check,ruleType,ruleValue,errMsg,formData,formName){var vaResult={};var firstErr=null;var pass=true;check.forEach(function(item){var isPass=checkRule(item,ruleType,ruleValue,formData);vaResult[item]=isPass;if(firstErr===null&&isPass===false){firstErr=getErrMsg(item,errMsg,ruleValue,ruleType);pass=false}});return[vaResult,firstErr,pass]}function checkRule(item,ruleType,ruleValue,formData){var ruleCheckers={type:type,noEmpty:noEmpty,min:min,max:max,equal:equal,unequal:unequal,pattern:pattern,accepted:accepted};if(item!=="message"){var checker=ruleCheckers[item];var isPass=checker(ruleValue,ruleType[item],ruleType,formData)}return isPass}function getErrMsg(item,errMsg,ruleValue,ruleType){var errMsgs={type:errMsg+"格式不正确",noEmpty:errMsg+"不能为空",max:errMsg+"不能大于"+ruleType[item],min:errMsg+"不能小于"+ruleType[item],equal:"两次"+errMsg+"不相同",unequal:errMsg+"不能相同",pattern:""+errMsg+ruleType.message,accepted:""+errMsg+ruleType.message};return errMsgs[item]}function va(){var vm=vnode_.context;var ruleValidate=vm.ruleValidate;var item_form=binding_.expression;var formData=vm[item_form];var formName=[];var formMsg=[];var formDOM=el_;var el_dom=[];var optionalRule=[];assert(formDOM,'未设置需要验证哪个表单 <form v-va="xxx"></form>');assert(formData,"未设置表单信息 ruleValidate:{}");if(formDOM.attributes["errClass"]){errClass=formDOM.attributes["errClass"].value}for(var i=0;i<formDOM.elements.length;i++){var prop=formDOM.elements[i];if(prop.attributes["prop"]){var item=prop.attributes["prop"].value.split(",");formName.push(item[0]);formMsg.push(item[1]);el_dom.push(prop)}}for(var _i=0;_i<formName.length;_i++){if(ruleValidate[formName[_i]]){var value_=formData[formName[_i]];var item_=[];for(var j in ruleValidate[formName[_i]]){item_.push(j)}optionalRule.push(new Rule(ruleValidate[formName[_i]],value_,formMsg[_i],item_,formData,formName[_i],el_dom[_i]))}}log(optionalRule);vm[item_form+"_valid"]=optionalRule;validate=optionalRule.every(function(x){return x.pass})}var MyPlugin={};var errClass="";var validate="";var el_;var binding_;var vnode_;var oldVnode_;MyPlugin.install=function(Vue,options){Vue.directive("va",{bind:function bind(el,binding,vnode,oldVnode){el_=el;binding_=binding;vnode_=vnode;oldVnode_=oldVnode;va()},update:function update(el,binding,vnode,oldVnode){el_=el;binding_=binding;vnode_=vnode;oldVnode_=oldVnode;va()}}),Vue.prototype.$axva=function(){return validate}};module.exports=MyPlugin;